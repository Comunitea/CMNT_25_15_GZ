<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
       
        <!-- Activity -->
        <record id="act_wait_moves_ship" model="workflow.activity">
            <field name="wkf_id" ref="sale.wkf_sale"/>
            <field name="name">wait_moves_ship</field>
            <field name="kind">function</field>
            <field name="action">action_ship_create()</field>
        </record>
        
        <record id="act_done2" model="workflow.activity">
            <field name="wkf_id" ref="sale.wkf_sale"/>
            <field name="name">done2</field>
            <field name="flow_stop">True</field>
            <field name="kind">function</field>
            <field name="action">write({'state':'done'})</field>
            <field name="join_mode">AND</field>
        </record>
        
        <!-- Remplazamos para que pueda moverse al estado done2 (ademÃ¡s de al done) cambiando el split_mode a or-->
         <record id="sale.act_invoice_end" model="workflow.activity">
            <field name="wkf_id" ref="sale.wkf_sale"/>
            <field name="name">invoice_end</field>
            <field name="kind">function</field>
            <field name="action">action_invoice_end()</field>
            <field name="split_mode">OR</field>
        </record>

        <!-- Transis
        tion -->
        <record id="trans_wait_ship_wait_moves_ship" model="workflow.transition">
            <field name="act_from" ref="sale.act_wait_ship"/>
            <field name="act_to" ref="act_wait_moves_ship"/>
            <field name="condition">(no_picking==True)</field>
        </record>

        <record id="sale.trans_wait_ship_ship" model="workflow.transition">
            <field name="act_from" ref="sale.act_wait_ship"/>
            <field name="act_to" ref="sale.act_ship"/>
            <field name="condition">((order_policy!='prepaid') or invoiced) and (no_picking!=True)</field>
        </record>
        
        <record id="trans_wait_moves_ship_to_done2" model="workflow.transition">
            <field name="act_from" ref="act_wait_moves_ship"/>
            <field name="act_to" ref="act_done2"/>
            <field name="signal">moves_done</field>
            <field name="condition">check_moves()</field>
        </record>
        
        <record id="trans_invoice_end_to_done2" model="workflow.transition">
            <field name="act_from" ref="sale.act_invoice_end"/>
            <field name="act_to" ref="act_done2"/>
        </record>
        
        

    </data>
</openerp>
