<?xml version="1.0" encoding="utf-8" ?>
<odoo>

 <record id="move_line_grouped_tree" model="ir.ui.view">
            <field name="name">stock.move.gropued.tree</field>
            <field name="model">move.line.grouped</field>
            <!--field name="inherit_id" ref="stock.view_move_line_tree"/-->
            <field name="arch" type="xml">
             <tree
                decoration-muted="state == 'cancel'"
                decoration-danger="(state not in ('cancel','done'))"
                string="GropuedMove Lines"
                create="0"
            >
                <field name="picking_id" string="Reference" />
                <field name="product_id" />
                <field name="removal_priority" invisible="0" />
                <!--field name="product_id" readonly="1"/-->
                <field name="location_id" />
                <field name="removal_dest_priority" invisible="0" />
                <field name="location_dest_id" invisible="0" />
                <field name="product_uom_qty" invisible="0" />
                <field name="quantity_done" string="Quantity Done" />
                <!--field name="lot_id"/-->
                <field
                    name="product_uom"
                    options="{'no_open': True, 'no_create': True}"
                    string="Unit of Measure"
                    groups="uom.group_uom"
                />
                <field name="virtual_tracking" invisible="0" />
                <field name="track_from_line" invisible="0" />
                <button
                    name="action_open_tracking_form"
                    attrs="{'invisible': [('virtual_tracking', '=', False)]}"
                    string="Open tracking"
                    type="object"
                    icon="fa-barcode"
                />
                <field name="state" />
                <field name="kanban_state" />
            </tree>
            </field>
        </record>

<record id="move_line_grouped_form" model="ir.ui.view">
        <field name="name">Move line grouped</field>
        <field name="model">move.line.grouped</field>
        <field name="arch" type="xml">
             <form string="Move Detail">
                 <header>
                     <!--field name="state" widget="statusbar" readonly="1"/-->
                     <field
                        name="state"
                        select="2"
                        widget="statusbar"
                        statusbar_colors='{"done":"green","partially_available":"red","assigned":"red"}'
                    />
                 </header>
                 <group attrs="{'invisible': [('state', '=', 'done')]}">
                    <group>
                         <field name="location_id" invisible="0" readonly="1" />
                        <field name="location_dest_id" invisible="0" />
                    </group>
                    <group>
                       <field name="picking_id" invisible="0" readonly="1" />
                        <!--field name="is_locked" invisible="0" readonly="1"/-->
                    </group>
                </group>
                    <group attrs="{'invisible': [('state', '=', 'done')]}">
                        <group>
                            <field name="product_id" readonly="1" />
                            <label for="product_uom_qty" />
                            <div class="o_row">
                                <span><field
                                    name="product_uom_qty"
                                    readonly="1"
                                    nolabel="1"
                                /></span>
                                <span><field
                                    name="product_uom"
                                    readonly="1"
                                    nolabel="1"
                                /></span>
                            </div>
                        </group>
                        <group>
                            <label for="quantity_done" />
                            <div class="o_row">
                                <span><field
                                    name="quantity_done"
                                    attrs="{'readonly': [('state', '=', 'done')]}"
                                    nolabel="1"
                                /></span>
                                <span><field
                                    name="product_uom"
                                    readonly="1"
                                    nolabel="1"
                                /></span>
                            </div>

                        </group>
                     </group>
                     <group
                    string="Tracking"
                    attrs="{'invisible': [('virtual_tracking','=', False)]}"
                >
                        <group invisible="1">
                            <group>
                                <field name="track_from_line" />
                                <field name="use_existing_lots" />
                            </group>
                            <group>
                                <field name="virtual_tracking" />
                                <field
                                name="available_serial_ids"
                                nolabel="1"
                                widget="many2many_tags"
                            />
                            </group>
                        </group>

                        <field
                        name="lot_ids_string"
                        nolabel="1"
                        attrs="{'readonly': [('state', '=', 'done')],
                           'invisible': ['|', '|', ('virtual_tracking','=', False), ('state', '=', 'done'), ('use_existing_lots', '=', True)]}"
                    />
                        <field
                        name="lot_ids"
                        nolabel="1"
                        widget="many2many_tags"
                        attrs="{'readonly': [('state', '=', 'done')],
                               'invisible': [('lot_ids', '=', []), ('available_serial_ids', '=', [])]}"
                        domain="[('id', 'in', available_serial_ids)]"
                    />
                    </group>
                    <footer class="oe_edit_only">
                        <button
                        string="Apply"
                        type="object"
                        name="apply_lot_ids_string"
                        class="oe_highlight"
                        attrs="{'invisible': ['|', ('lot_ids_string', '=', ''), ('use_existing_lots', '=', True)]}"
                    />
                        <button string="Confirm" special="save" class="oe_highlight" />
                        <button string="Discard" special="cancel" />
                    </footer>
            </form>
        </field>
</record>


    <record id="move_line_grouped_view_search" model="ir.ui.view">
        <field name="name">move.line.grouped.search</field>
        <field name="model">move.line.grouped</field>
        <field name="arch" type="xml">
            <search string="Groped Move Lines">
                <field name="picking_id" string="Reference" />
                <field name="product_id" />
                <field
                    name="loc_name"
                    filter_domain="[('loc_name', 'ilike', self)]"
                    string="From"
                />
                <field
                    name="loc_dest_name"
                    filter_domain="[('loc_name', 'ilike', self)]"
                    string="To"
                />
                <separator />
                <filter
                    string="To Do"
                    name="todo"
                    domain="[('quantity_done','=', 0)]"
                />
                <filter string="Done" name="done" domain="[('quantity_done','>',0)]" />
                <separator />
                <filter
                    string="Receptions"
                    name="incoming"
                    domain="[('picking_id.picking_type_id.code','=','incoming')]"
                />
                <filter
                    string="Deliveries"
                    name="outgoing"
                    domain="[('picking_id.picking_type_id.code','=','outgoing')]"
                />
                <filter
                    string="Internal"
                    name="internal"
                    domain="[('picking_id.picking_type_id.code','=','internal')]"
                />
                <filter
                    string="Manufacturing"
                    name="manufacturing"
                    domain="[('picking_id.picking_type_id.code','=','mrp_operation')]"
                />
                <separator />
                <group expand="0" string="Group By">
                    <filter
                        string="Pick State"
                        name="by_kanban_state"
                        domain="[]"
                        context="{'group_by':'kanban_state'}"
                    />
                    <filter
                        string="Product"
                        name="groupby_product_id"
                        domain="[]"
                        context="{'group_by': 'product_id'}"
                    />
                    <filter
                        string="Src Location"
                        name="groupby_location_id"
                        domain="[]"
                        context="{'group_by': 'loc_name'}"
                    />
                    <filter
                        string="Dest Location"
                        name="groupby_location_dest_id"
                        domain="[]"
                        context="{'group_by': 'loc_dest_name'}"
                    />
                    <filter
                        string="Status"
                        name="by_state"
                        domain="[]"
                        context="{'group_by':'state'}"
                    />
                </group>
            </search>
        </field>
    </record>

    <record id="move_line_grouped_action" model="ir.actions.act_window">
            <field name="name">Product Moves</field>
            <field name="res_model">move.line.grouped</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">tree</field>
            <field name="view_mode">kanban,tree,pivot,form</field>
            <field name="view_id" ref="move_line_grouped_tree" />
            <field name="search_view_id" ref="move_line_grouped_view_search" />
            <field name="context">{'search_default_groupby_location_dest_id': 1}</field>
            <field name="help" type="html">
              <p class="o_view_nocontent_empty_folder">
                There's no product move yet
              </p>
            </field>
    </record>
</odoo>
